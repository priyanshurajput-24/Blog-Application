{% extends 'base.html' %}

{% block content %}


{% if user %}
<div class="container">
    <div class="row">
        <div class="col-md-5">
            <div class="card" style="width: 18rem;">
                {% if user.profile_pic %}
                    <img src="{{ url_for('static', filename='images/' + user.profile_pic) }}" class="card-img-top" width="200px" align="right" >
                {% else %}
                    <img src="{{ url_for('static', filename='images/profile_pic.png') }}" class="card-img-top" width="200px" align="right" >
                {% endif %}
                <div class="card-body">
                  <h5 class="card-title text-center" >{{ user.name }}</h5>
                </div>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item"><strong>City : </strong>{{ user.city }}</li>
                  <li class="list-group-item"><strong>Followers : </strong>{{ total_follower|length }}</li>
                  <li class="list-group-item"><strong>Following : </strong>{{ total_following|length }}</li>
                  <li class="list-group-item"><strong>Total Posts : </strong>{{ user_posts|length }}</li>

                </ul>
                {% if current_user.user_id != user.user_id %}
                {% if current_user.user_id in user.followed|map(attribute = "followed_by_id")|list %}
                  <a href="{{ url_for('follow_user', user_id = user.user_id) }}"><div class="p-2"><button type="button" class="btn btn-danger" style="width: 100%;">Unollow</button></div></a>
                {% else %}
                  <a href="{{ url_for('follow_user', user_id = user.user_id) }}"><div class="p-2"><button type="button" class="btn btn-success" style="width: 100%;">Follow</button></div></a>
                {% endif %}
                {% endif %}
              </div>
        </div>
        
        
        <div class="col-md-7">
            <div class="card text-white bg-primary mb-3" style="max-width: 100%;">
                <div class="card-header bg-info">{{ user.name }}</div>
                <div class="card-body">
                  <h5 class="card-title">About {{ user.name }}</h5>
                  {% if user.about_author %}
                    <p class="card-text">{{ user.about_author }}</p>
                  {% else %}
                    <br>
                    <p class="card-text">Yet to be Updated..</p>
                  {% endif %}
                </div>
              </div>
              <br>
                    <hr><br>
                <div class="row d-flex justify-content-around">
                        {% for post in user_posts %}

                        <div class="shadow p-3 mb-5 bg-body rounded">
                            <h4><a href="{{ url_for('post', post_id = post.post_id) }}" style="text-decoration: none; color: brown;">{{ post.title }}</a> </h4>
                            {% set list1 = post.date_posted|string %}
                            <small><a href="{{ url_for('user_view', user_id = post.poster.user_id) }}" style="text-decoration: none;">{{ post.poster.name }}</a> |
                            {{ post.key_note }} |
                            {{ list1[0:10] }}</small><br><br>
                            {{ post.content|safe }} <br><br>
                            <a href="{{ url_for('post_comment', post_id = post.post_id) }}" class="btn btn-secondary btn-sm">View Posts</a>
                            <a href="{{ url_for('post_comment', post_id = post.post_id) }}" class="btn btn-primary btn-sm"> {{ post.comments|length }} Comment</a>
                        
                        
                            {% if current_user.name in post.likes|map(attribute = "author")|list %}
                                <a href="{{ url_for('like_post', post_id = post.post_id) }}" class="btn btn-warning btn-sm"> {{ post.likes|length }} Liked</a>    
                            {% else %}
                                <a href="{{ url_for('like_post', post_id = post.post_id) }}" class="btn btn-success btn-sm"> {{ post.likes|length }} Like</a>    
                            {% endif %}
                        
                        
                        
                            {% if post.author_id == current_user.user_id %}
                        
                                <a href="{{ url_for('edit_post', post_id = post.post_id) }}" class="btn btn-secondary btn-sm">Edit Post</a>
                                <a href="{{ url_for('delete_post', post_id = post.post_id) }}" class="btn btn-danger btn-sm">Delete Post</a><br>
                            
                            {% endif %}
                        
                        </div>

                            {% endfor %}
                    </div>
        
              

        
      </div>
    </div>
</div>
{% endif %}


{% endblock %}