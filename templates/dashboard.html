{% extends 'base.html' %}

{% block content %}

{% with messages = get_flashed_messages() %}
{% if messages %}
    {% for message in messages %}
        <h3>{{ message }}</h3>
    {% endfor %}
{% endif %}
{% endwith %}



<div class="card">
        <div class="card-header">
        <strong>Name : </strong>{{ current_user.name }}  
        </div>
        <div class="card-body">
                <div class="container">
                        <div class="row">
                                <div class="col-md-8">
                                        <h2>Your Profile</h2>
                                        <strong>Username : </strong>{{ current_user.username }}<br>
                                        <strong>Email : </strong>{{ current_user.email }}<br>
                                        <strong>City : </strong>{{ current_user.city }}<br>
                                        <strong>Followers : </strong>{{ total_follower|length }}<br>
                                        <strong>Following : </strong>{{ total_following|length }}</li><br>
                                        <strong>About User : </strong>{{ current_user.about_user }}<br>
                                        <strong>No. of Posts  : </strong>{{ user_posts|length }}<br>
                                        {% set list1 = current_user.join_date|string %}
                                        <strong>Date Joined : </strong>{{ list1[0:10] }}<br><br>
                                        

                                        <a href="{{ url_for('logout') }}" class="btn btn-primary">Logout</a>
                                        <a href="{{ url_for('update', user_id = current_user.user_id) }}" class="btn btn-secondary">Update Profile</a>
                                        <a href="{{ url_for('delete', user_id = current_user.user_id) }}" class="btn btn-danger">delete</a><br><br>
                                </div>
                                <div class="col-md-4">
                                        {% if current_user.profile_pic %}
                                                <img src="{{ url_for('static', filename='images/' + current_user.profile_pic) }}" width="200px" align="right" >
                                        {% else %}
                                                <img src="{{ url_for('static', filename='images/profile_pic.png') }}" width="200px" align="right" >
                                        {% endif %}
                                </div>
                        </div>
                </div>
        </div>
</div>


<br><br><br>



{% for post in user_posts %}
<div class="shadow p-3 mb-5 bg-body rounded">
    <h4><a href="{{ url_for('post', post_id = post.post_id) }}" style="text-decoration: none; color: brown;">{{ post.title }}</a> </h4>
    {% set list1 = post.date_posted|string %}
    <small><a href="{{ url_for('user_view', user_id = post.poster.user_id) }}" style="text-decoration: none;">{{ post.poster.name }}</a> |
    {{ post.key_note }} |
    {{ list1[0:10] }}</small><br><br>
    {{ post.content|safe }} <br><br>
    <a href="{{ url_for('post', post_id = post.post_id) }}" class="btn btn-secondary btn-sm">View Posts</a>
    <!-- <a href="{{ url_for('post_comment', post_id = post.post_id) }}" class="btn btn-primary btn-sm"> {{ post.comments|length }} Comment</a>


    {% if current_user.name in post.likes|map(attribute = "author")|list %}
        <a href="{{ url_for('like_post', post_id = post.post_id) }}" class="btn btn-warning btn-sm"> {{ post.likes|length }} Liked</a>    
    {% else %}
        <a href="{{ url_for('like_post', post_id = post.post_id) }}" class="btn btn-success btn-sm"> {{ post.likes|length }} Like</a>    
    {% endif %} -->



    {% if post.author_id == current_user.user_id %}

        <a href="{{ url_for('edit_post', post_id = post.post_id) }}" class="btn btn-warning btn-sm">Edit Post</a>
        <a href="{{ url_for('delete_post', post_id = post.post_id) }}" class="btn btn-danger btn-sm">Delete Post</a><br>
    
    {% endif %}

</div>
{% endfor %}



{% endblock %}